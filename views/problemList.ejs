<!DOCTYPE html>
<html>
<head>
  <style>


  
  .nav {
    background-color:rgba(0,0,0,0.2) !important;
    border-color: transparent !important;
    background-image:none !important;
    color:white !important;
  }
  .nav .btn {
    background-color: rgba(255, 255, 255, 0) !important;
    color: rgb(255, 255, 255);
    border-color: rgba(255, 255, 255, 0.205)!important;
  }
  .nav li{
    padding-left:30px;
    padding-right:20px;
  }
  .nav a{
    color:white !important;
  }
  .nav input{
    background-color: rgba(255, 255, 255, 0.171);
    border-color: transparent !important;
  }
  .nav ::placeholder {
    color:white !important;
  }



  .sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
  }

  .sticky:before,
  .sticky:after {
    content: '';
    display: table;
  }
  .sidebarContainer {
  }
  .sidebar {
    fill: solid;
    background: #24345E;
    color: white;
    padding-right: 0px !important;
  }
  .basicInfo {
    padding-left: 30px;
    padding-right: 40px;
    padding-top: 66px;
    padding-bottom: 30%; 
  }
  .basicInfo p {
    margin-bottom: 10px;
    line-height: 100%;
  }
  .active {
  }
  .links {
    display: block !important;
  }
  .header {
    display: inline-block;
  }
  .hdrBtns {
    display: inline-block;
    float:right;  }
    .Rplus {
      font-size: 48px;
    }
    .background {
      background-color: #E1EBF2
    }
    .box {
      margin-left: 10px;
      margin-right: 20px;
      margin-top: 10px;
      margin-bottom: 10px;
      padding: 15px;
    }
    .summary {
      font-size: 48px;
    }
    .topRight {
      position: absolute;
      top: 5px;
      right:10px;
    }
    .med {
      margin: 10px !important;
      margin-bottom: 25px !important;
    }

    .add {
      float: right;
      width: 5%;
    }

    .formSubmit {
      float: right;
      margin-top: 20px;
      margin-right: 2.3%;
    }
    .col-lg {
    }

    .current {
      padding-top: 10px;
      padding-bottom: 10px;
      border-bottom-style: solid;
      border-bottom-width: 1px;
      margin-bottom: 10px;
    }
    .links {
      background-color: #3D5982;
    }


.top-nav {
    font-size: 20px;
    font-weight: 400;
    padding: 10px;

  }
     .label{
    display: inline-block;
    font-weight: bold;
  }
  #R-plus{
    font-size: 35px;
    margin-left: 20px;
    font-weight: bold;
    color: green;
  }
  #Childrens{
    font-size: 35px
  }
  #pharmacy{
    margin-left: 80px;
  }

 .topRight {
      position: absolute;
      top: 5px;
      right:10px;

    }
  </style>
  <title>Patient Page</title>


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Pacifico"/>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="/files/js/stickyfillmin.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>


</head>
<body style="background-color: #E1EBF2;"> 
  <div class="background">
    <div class="sidebarContainer">
      <div class="row">
        <nav class="col-sm-2 sidebar">
          <div class = "sidebar sticky " >
            <div class = "basicInfo"> 
              <h2 id = "name">  </h2>
              <br>
              <p id="ageSex"></p>
              <p id="dob"></p>
              <p id="heightWeight"></p>
              <br>
              <p id="allergiesSide"></p>

            </div>
            <div class="links">
              <ul class="nav nav-pills nav-stacked links">
                <li class="active current">
                 <a href="problemList">Problem List</a></li>
                 <li><a href="patientPage">Patient Summary</a></li>
                 <li><a href="#section2">Social History</a></li>
                 <li><a href="allergies">Allergies</a></li>
                 <li><a href="#section4">Immunization Record</a></li>
                 <li><a href="#section3">Well Child Check</a></li>
                 <li><a href="#section5">Testing</a></li>
                 <li><a href="#section6">Growth Charts</a></li>
                 <li><a href="#section7">Nurse Notes</a></li>
                 <li><a href="#section8">Scans</a></li>
               </li>

             </ul>
           </div>
         </div>
       </nav>
       <div class="col-lg">   

        <div class = "card header">
        
            <div class = "card header" id = "topHead">
             <div class = "topRight">
              <a> User Name  | </a>
              <button class="btn btn-outline-success"> Logout </button>
            </div>

            <div>
              <p class = "label" id = "R-plus"> R+ </p>
              <p class = "label" id = "Childrens">Childrens</p>
              <a href="#Pharmacy" class = "top-nav" id = "pharmacy">Pharmacy</a>
              <a href="#AllPatients" class = "top-nav" id = "rec-pat">Recent Patients</a>
              <a href="../patientSearch.ejs" class = "top-nav" id = "search-pat">Search Patients</a>
            </div>
         </div>

     </div>


     <div class = "card box summary"> 
      <h3> Problem List </h3>

    </div>

    <div id = "chronMed" class="card med">
      <div class="card-header">
       <h3> Chronic Medication List </h3>
       <div class="row">
        <div class="col-sm"> Name of Rx </div>
        <div class="col-sm"> Dose </div>
        <div class="col-sm"> Time </div>
        <div class="col-sm"> Route </div>
        <div class="col-sm"> Start Date </div>
        <div class="col-sm"> End Date </div>
        <div class="col-sm"> Duration </div>
      </div>
    </div>
    <div id="chronMedContainer"></div>
    <div id = "chronMedFormContainer" class="box addField">
      <form id="chronMedForm" class="form-inline" method="post">
        <div>
          <div class="row">
            <div class="col-"><input type="text" name="medDrugName" placeholder="Name of rx"></div> 
            <div class="col" style="width:inherit !important;"><input type="text" name="medDose" placeholder="Dose"></div> 
            <div class="col"><input type="text" name="medTime" placeholder="Time"></div>
            <div class="col"><input type="text" name="medRoute" placeholder="Route"></div>
            <div class="col"><input type="text" name="medStartDate" placeholder="Start Date"></div> 
            <div class="col"><input type="text" name="medEndDate" placeholder="End Date"></div>
            <div class="col"><input type="text" name="medDuration" placeholder="Duration"></div>
          </div> 
          <div >
            <input type="submit" value="Submit" id="submitChronMed" class="formSubmit"> </div>
          </form>
        </div>
        <button id="addChronMed" class="add"> + </button>
      </div>

    </div>

    <div id = "acuteProb" class="card med">
      <div class="card-header">
       <h3> Acute Problems </h3>
       <div class="row">
        <div class="col-sm"> Diagnosis </div>
        <div class="col-sm"> Treatment </div>
        <div class="col-sm"> Dose </div>
        <div class="col-sm"> Time </div>
        <div class="col-sm"> Route </div>
        <div class="col-sm"> Date of Onset </div>
        <div class="col-sm"> Date of Resolution </div>
        <div class="col-sm"> Duration </div>
      </div>
    </div>
    <div id="acuteProbContainer"></div>

    <div id = "acuteProbFormContainer" class="box addField">
      <form id="acuteProbForm" class="form-inline" method="post">
        <div>
          <div class="row">
            <div class="col-"><input type="text" name="acuteDiagnosis" placeholder="Diagnosis"></div> 
            <div class="col" style="width:inherit !important;"><input type="text" name="acuteTreatment" placeholder="Treatment"></div> 
            <div class="col"><input type="text" name="acuteDose" placeholder="Dose"></div>
            <div class="col"><input type="text" name="acuteTime" placeholder="Time"></div>
            <div class="col"><input type="text" name="acuteRoute" placeholder="Route"></div> 
            <div class="col"><input type="text" name="acuteOnset" placeholder="Onset"></div>
            <div class="col"><input type="text" name="acuteResolution" placeholder="Resolution"></div>
            <div class="col"><input type="text" name="acuteDuration" placeholder="Duration"></div>

          </div> 
          <div >
            <input type="submit" value="Submit" id="submitAcuteProb" class="formSubmit"> </div>
          </form>
        </div>
        <button id="addAcuteProb" class="add"> + </button>
      </div>
    </div>


    <div id = "chronicProb" class="card med">
      <div class="card-header">
       <h3> Chronic Problems </h3>
       <div class="row">
        <div class="col-sm"> Diagnosis </div>
        <div class="col-sm"> Treatment </div>
        <div class="col-sm"> Dose </div>
        <div class="col-sm"> Time </div>
        <div class="col-sm"> Route </div>
        <div class="col-sm"> Date of Onset </div>
        <div class="col-sm"> Date of Resolution </div>
        <div class="col-sm"> Duration </div>
      </div>
    </div>

  </div>




</div>

</body>


<script>


 $(document).ready(function(){


  var elements = document.querySelectorAll('.sticky');
  Stickyfill.add(elements);
  // Initial Page Load
  $.ajax({
    type: 'POST',
    url: '/getPatientKeys',
    data: {
      search: '',
      field: 'lastName',
    },
    success: function(result) {
      patients = result.patient;
      getPatientData(result.patient);
    }
  });

  $('#chronMedForm').hide();

  $('#addChronMed').click(function() {
    $('#addChronMed').hide();
    $('#chronMedForm').show();
  });
  // Respond to submission of chron med form
  $('#chronMedForm').on('submit', function(event) {
    event.preventDefault();
    console.log("on submit");
    var data = $('#chronMedForm').serialize();

    $.ajax({
      type: 'POST',
      url: '/addChronMed',
      data: data,
      success: function (result) {
        $('#chronMedForm')[0].reset();

        $('#chronMedForm').hide();
        $('#addChronMed').show();
        updateChronMedCard(result);
        console.log(result);
      },
      error: function (xhr, ajaxOptions, thrownError) {
       console.log(xhr.status);
       console.log(xhr.responseText);
       console.log(thrownError);
     }
   });

  });





  $('#acuteProbForm').hide();
// Respond to submission of acute problem form
$('#acuteProbForm').on('submit', function(event) {
  event.preventDefault();
  console.log("on submit");
  var data = $('#acuteProbForm').serialize();

  $.ajax({
    type: 'POST',
    url: '/addAcuteProb',
    data: data,
    success: function (result) {
      $('#acuteProbForm')[0].reset();

      $('#acuteProbForm').hide();
      $('#addAcuteProb').show();
      updateAcuteProbCard(result);
      console.log(result);
    },
    error: function (xhr, ajaxOptions, thrownError) {
     console.log(xhr.status);
     console.log(xhr.responseText);
     console.log(thrownError);
   }
 });

});


$('#addAcuteProb').click(function() {
  $('#addAcuteProb').hide();
  $('#acuteProbForm').show();

});

});
// Updates the ChronMed Card after form submittion
var updateChronMedCard = function(chronMed) { 
  // Temporary data
  var chronMed = [{name: 'Cetirizine', dose: '100 mg', time: 'daily 8 am', route: 'PO', start: '1-12-2017', end: '1-12-2019', duration: "2 years"}, {name: 'Cetaphyl', dose: '200 mg', time: 'daily 9 am', route: 'PO', start: '1-12-2016', end: '1-12-2019', duration: "2 years"}];
  $('#chronMedContainer').empty();
  for (i = 0; i < chronMed.length; i++) {
    var chronMedCard = '<div class="box">' +
    '<div class="row"><div class="col-sm">' + chronMed[0].name + 
    '</div><div class="col-sm">' + chronMed[0].dose +
    '</div> <div class="col-sm">' + chronMed[0].time + 
    '</div> <div class="col-sm">' + chronMed[0].route +
    '</div> <div class="col-sm ">' + chronMed[0].start +
    '</div> <div class="col-sm ">' + chronMed[0].end +
    '</div> <div class="col-sm ">' + chronMed[0].duration +
    '</div></div>' ;
    $('#chronMedContainer').append(chronMedCard);
  }
}

// Updates the AcuteProb Card after form submission
var updateAcuteProbCard = function(chronMed) { 
 var acute = [{diagnosis: 'fungal infection', treatment: 'Ketanocozole', dose: '1 cc propanol', time: 'BID', route: 'Topical', start: '1-12-2017', end: '1-12-2019', duration: "1 month"}];
 $('#acuteProbForm').empty();
 for (i = 0; i < acute.length; i++) {
   var acuteCard = '<div class="box">' +
   '<div class="row"><div class="col-sm">' + acute[0].diagnosis + 
   '</div> <div class="col-sm">' + acute[0].treatment + 
   '</div> <div class="col-sm">' + acute[0].dose + 
   '</div> <div class="col-sm">' + acute[0].time +
   '</div> <div class="col-sm">' + acute[0].route +
   '</div> <div class="col-sm">' + acute[0].start +
   '</div> <div class="col-sm">' + acute[0].end +
   '</div> <div class="col-sm">' + acute[0].duration + '</div></div>' ;
   $('#acuteProbContainer').append(acuteCard);
 }
}



// Displays patient information
var getPatientData = function(patient) {
  var temp = patient;
  // Temporary data
  var medication = [{name: 'Cetirizine', dose: '100 mg', time: 'daily 8 am', route: 'PO', start: '1-12-2017', end: '1-12-2019', duration: "2 years"}, {name: 'Cetaphyl', dose: '200 mg', time: 'daily 9 am', route: 'PO', start: '1-12-2016', end: '1-12-2019', duration: "2 years"}];
  var allergies = [{item: 'dairy', severity: 'Mild', note: 'Avoid diary products'}]
  var acute = [{diagnosis: 'fungal infection', treatment: 'Ketanocozole', dose: '1 cc propanol', time: 'BID', route: 'Topical', start: '1-12-2017', end: '1-12-2019', duration: "1 month"}];

  console.log('here:' + patient);
  var cards = "";
  var date = new Date(2018,2,12);
  var i = 1;
  var patient = patient[i];

// Displays sidebar content
$('#name').text(patient.firstName + ' ' + patient.lastName);
  $('#ageSex').text(getAge(patient.birthdate) + ', ' + 'F' ); //paitient.sex
  $('#dob').text(patient.birthdate);
  $('#heightWeight').text(patient.height + " cm, " + patient.weight + " kgs");
  $('#allergiesSide').text('Allergies: ' + allergies[0].allergen );


// Displays chronic medication content
var medCard = '<div class="box">' +
'<div class="row"><div class="col-sm">' + medication[0].name + 
'</div> <div class="col-sm">' + medication[0].dose + 
'</div><div class="col-sm">' + medication[0].time +
'</div> <div class="col-sm">' + medication[0].route +
'</div> <div class="col-sm ">' + medication[0].start +
'</div> <div class="col-sm ">' + medication[0].end +
'</div> <div class="col-sm">' + medication[0].duration + '</div></div>' + 

'<div class="row"><div class="col-sm">' + medication[1].name + 
'</div> <div class="col-sm">' + medication[1].dose + 
'</div> <div class="col-sm">' + medication[1].time +
'</div> <div class="col-sm">' + medication[1].route +
'</div> <div class="col-sm">' + medication[1].start +
'</div> <div class="col-sm">' + medication[1].end +
'</div> <div class="col-sm">' + medication[1].duration
+ '</div> </div>';
$('#chronMedContainer').append(medCard);

// Displays acute problem content
var acuteCard = '<div class="box">' +
'<div class="row"><div class="col-sm">' + acute[0].diagnosis + 
'</div> <div class="col-sm">' + acute[0].treatment + 
'</div> <div class="col-sm">' + acute[0].dose + 
'</div> <div class="col-sm">' + acute[0].time +
'</div> <div class="col-sm">' + acute[0].route +
'</div> <div class="col-sm">' + acute[0].start +
'</div> <div class="col-sm">' + acute[0].end +
'</div> <div class="col-sm">' + acute[0].duration + '</div></div>' ;
$('#acuteProbContainer').append(acuteCard);


/*.   Chronic not yet defined. Need data for it
// Displays chronic problem content
  var chronicCard = '<div class="box">' +
  '<div class="row"><div class="col-sm">' + chronic[0].diagnosis + 
  '</div> <div class="col-sm">' + chronic[0].treatment + 
  '</div> <div class="col-sm">' + chronic[0].dose + 
  '</div> <div class="col-sm">' + chronic[0].time +
  '</div> <div class="col-sm">' + chronic[0].route +
  '</div> <div class="col-sm">' + chronic[0].start +
  '</div> <div class="col-sm">' + chronic[0].end +
  '</div> <div class="col-sm">' + chronic[0].duration + '</div></div>' ;
  $('#chronicProb').append(chronicCard);
  */
};



// Calculates age in years, months, weeks, days and returns it as a string

function getAge(fromdate, todate){
  if(todate) todate= new Date(todate);
  else todate= new Date();

  var age= [], fromdate= new Date(fromdate),
  y= [todate.getFullYear(), fromdate.getFullYear()],
  ydiff= y[0]-y[1],
  m= [todate.getMonth() + 1, fromdate.getMonth()],
  mdiff= m[0]-m[1],
  d= [todate.getDate(), fromdate.getDate()],
  ddiff= d[0]-d[1];

  if(mdiff < 0 || (mdiff=== 0 && ddiff<0))--ydiff;
  if(mdiff<0) mdiff+= 12;
  if(ddiff<0){
    fromdate.setMonth(m[1]+1, 0);
    ddiff= fromdate.getDate()-d[1]+d[0];
    --mdiff;
  }
  w = Math.floor(ddiff/7);
  ddiff = ddiff % 7;
 // 3 or older -> show year
 if (ydiff > 2) age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
 else if (ydiff> 0) {
 // Over a year -> show year and month
 age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
 if(mdiff> 0) age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
  // Less than a year -> show month and day
} else if (mdiff> 3) {
 age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
 if (w> 0) age.push(w+ ' week' + (w> 1? 's':''));
} else if (mdiff>0) {
  age.push(mdiff+ ' month'+(mdiff> 1? 's ':' '));
  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
} else {
  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
  if(ddiff> 0) age.push(ddiff+ ' day'+(ddiff> 1? 's':''));
}

if(age.length>1) age.splice(age.length-1,0,' and ');    
return age.join('');
}








</script>
</body>
</html>

