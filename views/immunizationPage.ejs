<!DOCTYPE html>
<html>
<head>
  <style>



  .nav {
    background-color:rgba(0,0,0,0.2) !important;
    border-color: transparent;

    background-image:none !important;
    color:white !important;
  }
  .nav .btn {
    background-color: rgba(255, 255, 255, 0) !important;
    color: rgb(255, 255, 255);
    border-color: rgba(255, 255, 255, 0.205);
  }
  .nav li{
    padding-left:30px;
    padding-right:20px;
  }
  .nav a{
    color:white !important;
  }
  .nav input{
    background-color: rgba(255, 255, 255, 0.171);
    border-color: transparent !important;
  }
  .nav ::placeholder {
    color:white !important;
  }

  .sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
  }

  .sticky:before,
  .sticky:after {
    content: '';
    display: table;
  }
  .sidebarContainer {

  }
  .sidebar {
    fill: solid;
    background: #24345E;
    color: white;
  }
  .basicInfo {
    padding-left: 30px;
    padding-right: 40px;
    padding-top: 66px;
    padding-bottom: 100px;
  }
  .active {
  }
  .links {
    display: block !important;
  }

    .background {
      background-color: #E1EBF2

    }
    .box {
      margin-left: 10px;
      margin-right: 20px;
      margin-top: 10px;
      margin-bottom: 10px;
      box-shadow: 2px 2px grey;
    }
    .summary {
      font-size: 48px;
    }
    .content-container{
      margin: 15px;
    }
    .topRight {
      position: absolute;
      top: 5px;
      right:10px;

    }

    #topHead {
      width:

    }
    #select{
      margin-left: 20px;
      box-shadow: 2px 2px grey;
    }

    #imm {
      align-self: center;
      font-weight: bold;

    }
  .div{
    box-shadow: 2px 2px grey;
  }

  .col-sm-9{
  padding-left: 0 !important;
}

  .top-nav {
    font-size: 20px;
    font-weight: 400;
    padding: 10px;

  }
  .label{
    display: inline-block;
    font-weight: bold;
  }
  #R-plus{
    font-size: 35px;
    margin-left: 20px;
    font-weight: bold;
    color: green;
  }
  #Childrens{
    font-size: 35px
  }
  #pharmacy{
    margin-left: 80px;
  }

    }
  </style>
  <title>Immunization Page</title>


  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Pacifico"/>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="/files/js/stickyfillmin.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


</head>
<body>
  <div class="background">

    <div class="sidebarContainer">
      <div class="row">
        <nav class="col-sm-3 sidebar">
          <div class = "sidebar sticky " >
            <div class = "basicInfo">
              <h2 id = "name"> Patient Name </h2>

              <p id="ageDOB"> Age: ###, DOB: ##-##-####</p>
              <p id="sexWH"> Female, ###.# kg, ### cm </p>
            </div>

            <ul class="nav nav-pills nav-stacked links">
              <li class="active">
                <a href="#section1">Patient Summary</a></li>
                <li><a href="#section2">Social History</a></li>
                <li><a href="#section3">Problem List</a></li>
                <li><a href="#section4">Immunization Record</a></li>
                <li><a href="#section3">Well Child Check</a></li>
                <li><a href="#section5">Testing</a></li>
                <li><a href="#section6">Growth Charts</a></li>
                <li><a href="#section7">Nurse Notes</a></li>
                <li><a href="#section8">Scans</a></li>

              </ul>
            </div>
          </nav>

          <div class="col-sm-9">

            <div class = "card header" id = "topHead">
             <div class = "topRight">
              <a> User Name  | </a>
              <button class="btn btn-outline-success"> Logout </button>
            </div>

            <div>
              <p class = "label" id = "R-plus"> R+ </p>
              <p class = "label" id = "Childrens">Childrens</p>
              <a href="#Pharmacy" class = "top-nav" id = "pharmacy">Pharmacy</a>
              <a href="#AllPatients" class = "top-nav" id = "rec-pat">Recent Patients</a>
              <a href="../patientSearch.ejs" class = "top-nav" id = "search-pat">Search Patients</a>
            </div>
         </div>

         <div class = "content-container">
         <div class = "card box summary">
          <h3 id = "imm"> Immunization Record </h3>
          </div>

        <table class="w3-table-all">
          <thead>
            <tr class="w3-light-grey">
            <th>Age</th>
            <th>Immunization</th>
            <th>Lot #</th>
            <th>Due Date</th>
            <th>Date Completed</th>
            </tr>
          </thead>
            <tr>
              <td> 6 weeks</td>
              <td>TB Vaccine</td>
              <td>7JEH4</td>
              <td>10/6/2013</td>
              <td>1/4/2015</td>
            </tr>

        </table>
      </div>



       <div class="container" id='patientCards'></div>

     </div>

   </div>

 </div>

</div>

</body>


<script>


 $(document).ready(function(){


  var elements = document.querySelectorAll('.sticky');
  Stickyfill.add(elements);
            // Initial Page Load


            $.ajax({
              type: 'POST',
              url: '/getPatientKeys',
              data: {
                search: '',
                field: 'lastName',
              },
              success: function(result) {
                patients = result.patient;
                getPatientData(result.patient);
              }
            });




            $.ajax({
              type: 'POST',
              url: '/getPatientKeys',
              data: {
                search: '',
                field: 'lastName',
              },
              success: function(result) {
                patients = result.patient;
                updatePatientKeys(result.patient);
              }
            });

          });



 var getPatientData = function(patient) {
  var temp = patient;
  var updates = [{date: '12-12-12', note: 'Do the test', status: 'Overdue'}]
  console.log('here:' + patient);
  var cards = "";
  var date = new Date(2018,2,12);
  var i = 1;
  var patient = patient[i];
  $('#name').text(patient.firstName + ' ' + patient.lastName);
  $('#ageDOB').text('Age: ' + getAge(patient.birthdate) + ',  ' + 'DOB: ' + patient.birthdate)

  $('#sexWH').text('Sex: ' +  'female' + ',  Weight: ' + patient.weight + " kgs,  Height: " + patient.height + " cm" );

  var updates = '<div class="row"> <div class="col-sm">' + updates[0].date +
  '</div> <div class="col-sm">' + updates[0].note +
  '</div><div class="col-sm">' + updates[0].status + '</div> </div>'
  $('#updates').append(updates);


  patient = temp;
  cards += '<div class="card">';
  cards += '<div class="card-body">';
  cards += '<h5 class="card-title">' + patient[i].lastName + ', ' +  patient[i].firstName +  '</h5>';
  cards += '<h6 class="card-subtitle mb-2 text-muted">Given Name: '+patient[i].givenName+', '+ patient[i].sex+'</h6>';
  cards += '<p class="card-text">';
  cards += 'Birthdate: ' + patient[i].birthdate + ', ';
  cards += 'Age: ' + getAge(date) + ', ';
                        // CALCULATE AGE FROM BIRTHDATE HERE
                        cards += 'Height: ' + patient[i].height + ', ';
                        cards += 'Weight: ' + patient[i].weight + ', ';
                        cards += 'Father: ' + patient[i].father + ', ';
                        cards += 'Mother: ' + patient[i].mother + ', ';
                        cards += '</p>';
                        cards += '<a href="/#'+ patient[i].id + '" class="card-link">Card link</a>';
                        cards += '</div>';
                        cards += '</div>';

                      }
                   //   document.getElementById('patientCards').innerHTML = cards;




                   function getAge(fromdate, todate){
                    if(todate) todate= new Date(todate);
                    else todate= new Date();

                    var age= [], fromdate= new Date(fromdate),
                    y= [todate.getFullYear(), fromdate.getFullYear()],
                    ydiff= y[0]-y[1],
                    m= [todate.getMonth() + 1, fromdate.getMonth()],
                    mdiff= m[0]-m[1],
                    d= [todate.getDate(), fromdate.getDate()],
                    ddiff= d[0]-d[1];

                    if(mdiff < 0 || (mdiff=== 0 && ddiff<0))--ydiff;
                    if(mdiff<0) mdiff+= 12;
                    if(ddiff<0){
                      fromdate.setMonth(m[1]+1, 0);
                      ddiff= fromdate.getDate()-d[1]+d[0];
                      --mdiff;
                    }
                    w = Math.floor(ddiff/7);
                    ddiff = ddiff % 7;
                  // 3 or older -> show year
                  if (ydiff > 2) age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                  else if (ydiff> 0) {
                    // Over a year -> show year and month
                    age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                    if(mdiff> 0) age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                    // Less than a year -> show month and day
                  } else if (mdiff> 3) {
                   age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                   if (w> 0) age.push(w+ ' week' + (w> 1? 's':''));
                 } else if (mdiff>0) {
                  age.push(mdiff+ ' month'+(mdiff> 1? 's ':' '));
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                } else {
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                  if(ddiff> 0) age.push(ddiff+ ' day'+(ddiff> 1? 's':''));
                }

                if(age.length>1) age.splice(age.length-1,0,' and ');
                return age.join('');
              }



              var updatePatientKeys = function(patient) {
                console.log('here:' + patient);
                var cards = "";
                var date = new Date(2018,2,12);

                for(var i = 0; i < patient.length; i++) {
                  cards += '<div class="card">';
                  cards += '<div class="card-body">';
                  cards += '<h5 class="card-title">' + patient[i].lastName + ', ' +  patient[i].firstName +  '</h5>';
                  cards += '<h6 class="card-subtitle mb-2 text-muted">Given Name: '+patient[i].givenName+', '+ patient[i].sex+'</h6>';
                  cards += '<p class="card-text">';
                  cards += 'Birthdate: ' + patient[i].birthdate + ', ';
                  cards += 'Age: ' + getAge(date) + ', ';
                        // CALCULATE AGE FROM BIRTHDATE HERE
                        cards += 'Height: ' + patient[i].height + ', ';
                        cards += 'Weight: ' + patient[i].weight + ', ';
                        cards += 'Father: ' + patient[i].father + ', ';
                        cards += 'Mother: ' + patient[i].mother + ', ';
                        cards += '</p>';
                        cards += '<a href="/#'+ patient[i].id + '" class="card-link">Card link</a>';
                        cards += '</div>';
                        cards += '</div>';
                      }
                      document.getElementById('patientCards').innerHTML = cards;
                    };



                    function getAge(fromdate, todate){
                      if(todate) todate= new Date(todate);
                      else todate= new Date();

                      var age= [], fromdate= new Date(fromdate),
                      y= [todate.getFullYear(), fromdate.getFullYear()],
                      ydiff= y[0]-y[1],
                      m= [todate.getMonth() + 1, fromdate.getMonth()],
                      mdiff= m[0]-m[1],
                      d= [todate.getDate(), fromdate.getDate()],
                      ddiff= d[0]-d[1];

                      if(mdiff < 0 || (mdiff=== 0 && ddiff<0))--ydiff;
                      if(mdiff<0) mdiff+= 12;
                      if(ddiff<0){
                        fromdate.setMonth(m[1]+1, 0);
                        ddiff= fromdate.getDate()-d[1]+d[0];
                        --mdiff;
                      }
                      w = Math.floor(ddiff/7);
                      ddiff = ddiff % 7;
                  // 3 or older -> show year
                  if (ydiff > 2) age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                  else if (ydiff> 0) {
                    // Over a year -> show year and month
                    age.push(ydiff+ ' year'+(ydiff> 1? 's ':' '));
                    if(mdiff> 0) age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                    // Less than a year -> show month and day
                  } else if (mdiff> 3) {
                   age.push(mdiff+ ' month'+(mdiff> 1? 's':''));
                   if (w> 0) age.push(w+ ' week' + (w> 1? 's':''));
                 } else if (mdiff>0) {
                  age.push(mdiff+ ' month'+(mdiff> 1? 's ':' '));
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                } else {
                  if(w> 0) age.push(w+ ' week'+(w> 1? 's':''));
                  if(ddiff> 0) age.push(ddiff+ ' day'+(ddiff> 1? 's':''));
                }

                if(age.length>1) age.splice(age.length-1,0,' and ');
                return age.join('');
              }


            </script>
          </body>
          </html>
